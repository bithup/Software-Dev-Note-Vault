redis称为key-value数据库，redis中的数据以key-value形式存储，key都是string类型，value是Redis提供的数据类。

### 数据结构

- 基础类型
	- String
	- List：可从两端进出数据
	- Set
	- Zset
	- Hash
- 特殊类型
	- HyperLogLogs（基数统计）
	- Bitmaps (位图)
	- geospatial （地理位置）
- 新增类型
	- Stream
redis没有提供数值类型，将一个数值存储在redis中，实际上是以String类型来存储的，String类型提供加减相关的命令。
### 核心功能
> Redis支持的核心功能，包括持久化，消息，事务，高可用；高可用方面包括，主从，哨兵等；高可拓展方面，比如 分片机制等。

#### 持久化
两种方式：RDB和AOF

---
RDB持久化（内存快照）
触发方式：
- 手动触发
	- save：阻塞，生产环境不建议用
	- bgsave：阻塞很短
- 自动触发
	- redis.conf中配置save m n
---
AOF持久化（日志记录）

---
混合使用：内存快照间隔期间使用日志记录

#### 发布订阅

#### 事件驱动
下面是一个简单的示例，演示了如何使用 Redis 的事件机制来监控键的创建和删除事件：

1. **配置事件监听**:
    

    ```shell
    CONFIG SET notify-keyspace-events Ex
    ```
    
2. **订阅事件**:

    ```shell
    PSUBSCRIBE __keyevent@0__:*
    ```
    
3. **创建和删除键**:
    

    ```shell
    SET mykey value
    DEL mykey
    ```
    
4. **查看事件**: 在另一个 Redis 客户端窗口中，你会看到类似于以下的输出：
    
    
    ```
    11) "psubscribe"
    22) "__keyevent@0__:del"
    33) "mykey"
    41) "psubscribe"
    52) "__keyevent@0__:expired"
    63) "mykey"
    ```
    


#### 事务

#### 主从复制

#### 哨兵
主从复制，主节点故障，从节点自动转为主节点
#### 分片


### 使用场景

- **HyperLogLogs 基数统计用来解决什么问题**？

这个结构可以非常省内存的去统计各种计数，比如注册 IP 数、每日访问 IP 数、页面实时UV、在线用户数，共同好友数等。

- **Bitmap用来解决什么问题**？
只有0 和 1 两个状态。
比如：统计用户信息，活跃，不活跃！ 登录，未登录！ 打卡，不打卡！ **两个状态的，都可以使用 Bitmaps**！

- **geopos**
Redis 的 Geo 在 Redis 3.2 版本就推出了! 这个功能可以推算地理位置的信息: 两地之间的距离, 方圆几里的人

### 常见问题

缓存穿透：缓存和数据库都没有
缓存击穿：缓存没有，数据库有
缓存雪崩：缓存大批量失效

#### 缓存一致性问题（同步缓存）
数据库更新了，如何同步到缓存
方案一：
- 在MySQL中对要操作的数据设置触发器Trigger，监听操作
- 客户端（NodeServer）向MySQL中写入数据时，触发器会被触发，触发之后调用MySQL的UDF函数
- UDF函数可以把数据写入到Redis中，从而达到同步的效果
- 这种方案适合于读多写少，并且不存并发写的场景
- 因为MySQL触发器本身就会造成效率的降低，如果一个表经常被操作，这种方案显示是不合适的

方案二：
基于订阅binlog的同步机制


---

可用于缓存，事件发布或订阅，高速队列等场景