## Mysql

### 命令

- 登陆
- 数据库的创建、删除、修改、查询、使用/切换。
- 表的创建、修改、删除、查看
  1.查看表结构desc table name
  2.drop tablename
  3.alter table test add/drop/change column
  4.alter table test rename test1
  5.alter table test modify 修改字段类型
- 数据库管理命令
  1.设置权限
  2.创建修改用户

### 数据定义语言 DDL

- 创建、修改数据库
- 创建、修改表



### 数据操纵语言 DM(manipulation)L 

- Insert into tableName(column1, column2) values (val1, val2)
- Update tableName set column1 = val1 where
- Delete from tableName where



### 数据库查询语言DR(retrieval)L

- Select *，系统要先解析出所有字段的名字，如果记录数特别多，效率低
- DUAL是虚拟表
- 查询某个字段a为空的记录，使用where a is null而非a=null
- mysql datetime只记录年月日，timestamp才记录时分秒
- Where createDate='2011-11-11'
- 近似查询，使用like关键字：where name like '%e'/'e%'
- 如果字段名和关键字相同，需要给字段名加上豆引（号）
- 排序：默认升序ASC，降序desc，可同时使用多个排序条件
- Count()和Sum()函数与group by / having 子句
  count是统计分组之后的行数，having子句给组添加限制条件。
  不能简单用where代替having，where子句在分组之前执行
- distinct去除重复
- limit分页



### 事务控制语句 Transaction Control Language 

- 事务就是多步数据库操作，如果有一步操作失败，整个事务失败
- 原子性（atomicity）、一致性（consistency）、隔离性（isolation）、持续性（durability）。这四个属性通常称为ACID特性
- 事务的提交有自动提交和手动提交，set autocommit = true;
- 手动提交模式下：commit提交事务，savepoint name_point保存还原点，rollback name_point回滚事务



### 数据库引擎

- 不同引擎适用不同场景，show engines;查看支持的引擎
- InnoDB：最常用，支持事务、行锁、外键
- MRG_MYISAM：MyISAM的组合
- MyISAM：不支持事务等功能，查询效率高，修改效率低，支持分表。
- MEMEORY：速度快，适合缓存数据
- BLACKHOLE
- CSV
- ARCHIVE
- PERFORMANCE_SCHEMA



### 数据类型

- https://www.cnblogs.com/dengyanchuan/p/10638775.html
- 约束：非空/主键/外键/唯一性
- 创建索引

> 1 #方法一：创建表时
>  2     　　CREATE TABLE 表名 (
>  3                 字段名1  数据类型 [完整性约束条件…],
>  4                 字段名2  数据类型 [完整性约束条件…],
>  5                 [UNIQUE | FULLTEXT | SPATIAL ]   INDEX | KEY
>  6                 [索引名]  (字段名[(长度)]  [ASC |DESC]) 
>  7                 );
>  8 
>  9 
> 10 #方法二：CREATE在已存在的表上创建索引
> 11         CREATE  [UNIQUE | FULLTEXT | SPATIAL ]  INDEX  索引名 
> 12                      ON 表名 (字段名[(长度)]  [ASC |DESC]) ;
> 13 
> 14 
> 15 #方法三：ALTER TABLE在已存在的表上创建索引
> 16         ALTER TABLE 表名 ADD  [UNIQUE | FULLTEXT | SPATIAL ] INDEX
> 17                              索引名 (字段名[(长度)]  [ASC |DESC]) ;
> 18                              
> 19 #删除索引：DROP INDEX 索引名 ON 表名字;
>
> 创建/删除索引的语法

索引的类型

- 主键索引
- 唯一索引
- 普通索引
- 组合索引
- 全文索引

索引通常是使用B+树作为底层数据结构



连接查询优化

- mysql只支持循环嵌套链接算法（三种实现），优化器根据情况选择
- 关联字段有索引，可一减少链接查询时比较的次数。
- 如果join两张表很大，必须要在关联字段上建立索引
- left join，以左表为基准
- where条件在join条件之后生效



分库分表

- 将不同业务数据的表放到不同数据库中
- 可以按ID的哈希值或其他规则将表分片，当用户增加时，可增加一台服务，增加一个分片
- 单库单表
- 将表水平拆分，分表
- 
- 读写分离
- 主从备份

表锁和行锁

- 表锁虽然开销小，锁表快，但高并发下性能低。行锁虽然开销大，锁表慢，但高并发下相比之下性能更高。事务和行锁都是在确保数据准确的基础上提高并发的处理能力
- InnoDB更适合高并发场景

事务

- 事务的使用场景：转账、删除有关联的多张表中的数据

- begin开启事务，rollback回滚，commit提交结束事务

- ```java
  package com.scl.test.transcaction;
  import java.sql.Connection;
  import java.sql.Statement;
  import org.junit.Test;
  public class TestTranscaction
  {
      @Test
      public void testTransaction() throws Exception
      {
          Connection conn = null;
          Statement statement = null;
          try
          {
              conn = JDBCHelper.getConnection();
  
              conn.setAutoCommit(false); //开启事务，禁止自动提交
              String sql1 = "update t_account t set t.money=t.money-100 where t.name ='a'";
              String sql2 = "update t_account t set t.money=t.money+100 where t.name ='b'";
              statement = conn.createStatement();
              // statement.setString(1, "a");
              statement.addBatch(sql1);
              statement.addBatch(sql2);
              statement.executeBatch();
              conn.commit(); //执行成功，提交事务
          }
          catch (Exception e)
          {
              conn.rollback(); //发生异常，事务回滚
          }
          finally
          {
              JDBCHelper.disposeConnect(statement, conn);
          }
      }
  }
  ```

  

## redis

- String/Hash/List/Set/Sorted Set
- 登陆命令：redis-cli -h host -p port -a password

操作key相关的命令

| 命令               | 作用         |
| ------------------ | ------------ |
| Exists key         | 判断是否存在 |
| Del key            | 删除         |
| Dump key           | 序列化       |
| Expire key seconds | 设置过期时间 |
| Rename key newly   | 重命名       |
| type key           | 判断数据类型 |
|                    |              |
|                    |              |
|                    |              |

字符串相关命令

| 命令                   | 作用                        |
| ---------------------- | --------------------------- |
| Set key val            | 设置值                      |
| get key                | 获取值                      |
| Getrange key start end | 获取子字符串                |
| Strlen key             | 判断长度                    |
| Setnx key value        | key不存在就设置，存在就不变 |
|                        |                             |
|                        |                             |
|                        |                             |
|                        |                             |

### mogoDB

