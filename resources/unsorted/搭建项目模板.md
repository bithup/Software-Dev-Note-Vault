# 搭建项目模板

- [ ] 配置mvc
- [ ] 统一的请求和响应格式
- [ ] 分页
- [ ] 配置最新swagger
- [ ] 配置全局异常
- [ ] 用户角色设计
- [ ] 数据库事件
- [ ] mybatis配置
- [ ] 文件上传模块，建立文件资源记录表（原文件名，生成文件名，文件类型，时间，是否被引用，是否删除）
- [ ] 流程审批模块





遵循coding guidelines

## 项目的结构（架构）

参考DDD分层架构

分为boot和common

- boot
  - adapter
    - controller
  - util 对第三方库做进一步的封装。
- common只依赖jdk，common中util类的封装不能依赖第三方库，可以copy第三方库源代码；减少对第三方库的依赖

## 项目的技术选型

maven依赖导入

1. web mvc
2. validate
3. swagger
4. mybatis
5. 

## 项目可以复用或公用的部分（common）

### 常量

定义常量的方式有枚举、类常量、接口常量

可以将一些常用的常量集中整理：比如日期格式化的pattern，校验参数的正则（手机号、邮箱等）

思考🍁：这些方式适用于什么场景？

### 工具类

字符串

加密

json序列化

浮点数格式化：比如浮点数保留2位小数，格式为百分号等，在需要格式化的的地方，调用静态方法获取format实例。

Redis：是否需要放在工具类下

思考🍁：对每个util建立单独的包还是模块，配置类放在util包下还是config包下



### 异常

对各总异常定义相应的异常类型，并赋予相应的异常码，方便查找异常；

异常基类：RuntimeException  

异常的继承链：Serializable --> Throwable --> Exception/Error --> RuntimeException

## SpringBoot

使用哪些必要注解

主类：

banner个性化

配置文件生效方式

## Spring Mvc

为什么全局异常处理器，不能捕获参数校验错误的异常

mvc的配置：过滤器、拦截器，如何定义，如何注入到spring

session的处理：是否引入spring session

定义公共的登录认证接口：sessionService

json的配置

### 自定义注解

如何定义，如何注入到spring



### 入参

统一的入参格式

### 出参

统一的出参格式

### 分页排序

Page接口，参考mybatis





## 代码自动生成模块

研究generater，修改模板，保留必要的基础SQL

## 数据库

### 实体类和表设计

实体类基类，数据库中每条记录都因该包含创建时间、修改时间、创建人、修改人等；记录是否删除，对于不能物理删除的记录使用deleted字段标识；

不是所有表都需要id字段，比如多对多关联表；



创建有关联关系的表，创建各种数据类型的字段，保存SQL

### ORM

#### mybatis

参考：ORM - mybatis、Java SE - Enum



实现typeHadler

配置yaml文件

编写配置类

生成mapper和实体类（看看各种数据类型都对应什么java类型）

整理mybatis注解的用法，多对多映射，

研究mybatis拦截器

使用单元测试：在不集成spring的情况下测试，和在集成spring的情况下测试



## DTO转换工具类

如何实现比较合理，

## 第三方接口调用模块

open-api

open-api service， 封装成相应的service接口，捕获第三方错误并处理（比如重发）

这部分代码应该放在哪里



## 认证授权

引入outh，spring security

## 资源库

使用数据库保存静态资源，图片的网络地址

比如icon图标







## 

# 数据字典

## 如何存储数据字典

### 1. 枚举类

数据字典枚举类该如何定义，实现什么接口

### 2. 数据库

### 3. 配置文件

## 如何转换

### 使用json注解

### mapstruct

能否自定义某些字段的转换方法，

比如在DTO中自定义一个getXXX的方法

##  如何提升性能

当数据字典存储在数据库时，每次转换都要查询，可以考虑将其缓存，缓存的方式可以使用Map集合或redis等

如何同步：如果管理员在后台调用字典修改接口，修改数据库成功后，发送一个事件通知更新缓存Map







---



参考项目：[usage.md · 侯坤林/system-dict-starter - Gitee.com](https://gitee.com/houkunlin/system-dict-starter/blob/main/usage.md)

是和否使用基本类型还是包装类型存储：基本类型有默认值且不能为NULL，如果使用基本类型，必须初始化其值，从数据库查询时不能为null，否则会报错；如果使用包装类型，如果数据库字段不能为空，必须初始化值





# 随笔

## 系统可配置性

> 询单可撤回时间的变更，如果将时间限制写在代码或配置文件理，更改后都需要重启系统

思路：将类似简单配置保存在数据库，并在管理后台可配置，适用访问量少的接口（撤回询单）

> 访问量大的接口，涉及配置时，不适合每次都取数据库的值

思路：将配置缓存到redis，更新数据库配置后同步到缓存；或者写在配置文件中

## 降低版本上线对线上使用的影响

> 上线新功能，如何尽量减少对系统使用的影响，如何通知系统用户系统正在更新

思路：1.将更新频繁的业务模块和比较稳定的模块拆分出来，比如：爬虫类的业务，失效频繁，可将其作为单独服务，失效时只需更新爬虫服务；集成第三方接口（飞书、抖音），可以考虑将其拆分成RPC服务。

## 如何写日志有利于定位线上bug

> 日志报错信息如何能快速定位到代码
>
> 代码的严谨性，通过判断减少空指针异常

## 版本迭代

> 询单一期字段较少，功能相对复杂，后期加入大量新的字段，升级成本高，如何在前期规划方便后期升级改造

## 前后端分离

> 如何定义接口规则，GET、POST请求的传参格式（日期，布尔），

## 数据字典

如何将系统中的某些状态定义为枚举值，数据库存数值，查询时返回枚举类

建立一个完整的地址信息、邮编库

> 数据字典和文本转换方式
>
> 枚举类，使用时比较方便
>
> 数据库，更新比较方便
>
> 字典值转文字，使用json注解
>
> 文字转字典值，直接传
>
> 参考项目：[usage.md · 侯坤林/system-dict-starter - Gitee.com](https://gitee.com/houkunlin/system-dict-starter/blob/main/usage.md)

## 接口重复提交

接口重复提交如何保证数据的正确？

1. 如果数据是不能重复的，数据库加唯一索引，接口重复提交，写入时报错
2. 如果数据除了id没有唯一索引，数据库会生成多条重复数据，虽然逻辑上没有错，但也是重复数据，需要防止重复提交
3. 出于安全考虑，对接口的访问频率做限制，比如短信发送接口

[瞬间几千次的重复提交，我用 SpringBoot+Redis 扛住了！ (qq.com)](https://mp.weixin.qq.com/s/go98iyx4JrBNPhMm8HlyPg)

[阿里面试官：接口的幂等性怎么设计？ (qq.com)](https://mp.weixin.qq.com/s/ds8DLAQgeztzzFKcirMJTA)

[服务端如何防止重复支付 (qq.com)](https://mp.weixin.qq.com/s/DQ5FO7hRplHgZPalprpHig)



